<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumbia Radio - Live 24/7</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; background: black; color: white; }
        #song-list { list-style: none; padding: 0; }
        #song-list li { margin: 5px 0; }
        .mute-button { background: red; color: white; border: none; padding: 10px; cursor: pointer; }
        audio { width: 100%; max-width: 400px; margin-top: 20px; }
        @media (max-width: 600px) { body { font-size: 14px; } }
    </style>
</head>
<body>
    <h1>üé∂ Cumbia Radio - Live 24/7 üé∂</h1>
    
    <audio id="audio-player" autoplay muted playsinline controls>
        <source id="audio-source" src="" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <button class="mute-button" onclick="toggleMute()">üîá Mute</button>

    <h2>Now Playing:</h2>
    <p id="current-song">Loading...</p>

    <h2>Next Songs:</h2>
    <ul id="song-list"></ul>

    <script>
        async function updateSongInfo() {
            try {
                const response = await fetch('/current-song');
                const data = await response.json();
    
                document.getElementById('current-song').innerText = data.current;
                document.getElementById('audio-source').src = '/stream?nocache=' + new Date().getTime();
                document.getElementById('audio-player').load();
    
                // üîÑ Sync song position based on server's song start time
                const songStartTime = data.songStartTime;
                const elapsedTime = (Date.now() - songStartTime) / 1000; // Convert ms to seconds
    
                let audio = document.getElementById('audio-player');
                audio.currentTime = elapsedTime; // Jump to correct part of the song
                
                // üîä Force unmuted playback
                audio.muted = false;
                audio.play()
                    .then(() => console.log("Autoplay successful ‚úÖ"))
                    .catch(error => {
                        console.warn("Autoplay blocked üö® Waiting for user interaction...");
    
                        // Wait for user interaction (click/tap) to start playing
                        document.body.addEventListener("click", async () => {
                            audio.muted = false;
                            await audio.play();
                            console.log("User interaction started playback ‚úÖ");
                        }, { once: true });
                    });
    
                const songList = document.getElementById('song-list');
                songList.innerHTML = data.next.map(song => `<li>${song}</li>`).join('');
            } catch (error) {
                console.error('Error fetching song info:', error);
            }
        }
    
        let audio = document.getElementById('audio-player');
    
        // üîÑ Try to autoplay when page loads
        window.addEventListener("load", () => {
            updateSongInfo();
        });
    
        // ‚è≠ Move to next song when current one ends
        audio.addEventListener("ended", function () {
            updateSongInfo();
        });
    
        updateSongInfo(); // Initial song load
    </script>                
</body>
</html>
